<link href="https://fonts.googleapis.com/css?family=Open+Sans:300&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Indie+Flower&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@400;500&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=PT+Sans:wght@400;500;600;700&display=swap">

<script src="https://unpkg.com/markdown-it/dist/markdown-it.min.js"></script>
<script src="https://unpkg.com/markdown-it-mathjax/dist/markdown-it-mathjax.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js" id="MathJax-script" async></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">


<script src="http://www.google.com/jsapi" type="text/javascript"></script>
<script type="text/javascript">google.load("jquery", "1.3.2");</script>

<style type="text/css">

  body {
    background-color: rgb(255, 255, 255);
    font-family: 'Open Sans', sans-serif;
    font-weight: 100;
    font-size: 32px;
    margin-left: auto;
    margin-right: auto;
    width: 1200px;
  }

  #image-slider {
    text-align: center;
  }

  #image-slider img {
    width: 800px;
  }

  #image-slider button {
    background-color: #0078c0;
    border: none;
    color: white;
    padding: 15px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    cursor: pointer;
    transition-duration: 0.4s;
    border-radius: 50%;  /* make the button circular */
  }

  #image-slider button:hover {
    background-color: white;
    color: #0078c0;
  }

  .circle {
    height: 15px;
    width: 15px;
    background-color: #bbb;
    border-radius: 50%;
    display: inline-block;
    margin: 1px;
  }

  .selected {
    background-color: #0078c0;
  }

  /* .paper-link {
      color: #0078C0;
      text-decoration: none;
      font-weight: bold;
      font-size: 24px;
  } */

  .rectangle {
    display: inline-block;
    border: 2px solid #0078c0;
    border-radius: 10px;
    padding: 10px;
    position: relative;
    z-index: 1; /* Add this line */
  }

  .rectangle a {
    color: #0078c0;
    text-decoration: none;
    font-size: 20px;
    position: relative; /* Add this line */
    z-index: 2; /* Add this line */
  }

  .rectangle:hover {
    border: 2px solid white;
    background: #0078c0;
  }

  .rectangle:hover a {
    color: white;
    text-decoration: none;
  }

  .rectangle::before {
    content: '';
    position: absolute;
    top: -10px;
    left: -10px;
    right: -10px;
    bottom: -10px;
    border-radius: 10px;
  }

  .rectangle .github-link {
    color: #0078c0;
    text-decoration: none;
    font-weight: bold;
    font-size: 24px;
  }


  .title-font {
    font-family: 'Google Sans', sans-serif;
    font-weight: 500;
    font-size: 40px;
  }

  .author-font {
    font-family: 'Google Sans', sans-serif;
    font-weight: 400;
    font-size: 20px;
  }

  .tldr-summary {
    font-size: 18px; /* Adjust the size as needed */
    margin-top: 4%;
    /* Creates space between the image and the text */
    /* Any other styling you want to add */
  }

  .video-responsive {
    position: relative;
    padding-bottom: 56.25%; /* Aspect ratio */
    height: 0;
    overflow: hidden;
  }

  .video-responsive iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }
  pre {
    background-color: #f8f8f8; /* Light gray background */
    padding: 15px; /* Padding around the text */
    border: 1px solid #ddd; /* Light gray border */
    overflow: auto; /* Ensures the content is scrollable if it overflows */
    font-family: 'Courier New', Courier, monospace; /* Monospaced font for better readability */
    font-size: 14px; /* Slightly smaller font size */
    line-height: 1.4; /* Line height for better readability */
    white-space: pre-wrap; /* Allows text to wrap within the container */
    word-break: break-all; /* Ensures long lines of text break as needed */
    margin-bottom: 20px; /* Space below the section */
  }




  /* h1 {
    font-family: 'Open Sans', sans-serif;
    font-weight: 600;
  }*/

  h2 {
    font-family: 'Open Sans', sans-serif;
    font-weight: 600;
    /* margin-top: 10%; */
    margin-top: 0 auto;
  }







  .disclaimerbox {
    background-color: #eee;
    border: 1px solid #eeeeee;
    border-radius: 10px ;
    -moz-border-radius: 10px ;
    -webkit-border-radius: 10px ;
    padding: 20px;
  }

  video.header-vid {
    height: 140px;
    border: 1px solid black;
    border-radius: 10px ;
    -moz-border-radius: 10px ;
    -webkit-border-radius: 10px ;
  }

  img.header-img {
    height: 140px;
    border: 1px solid black;
    border-radius: 10px ;
    -moz-border-radius: 10px ;
    -webkit-border-radius: 10px ;
  }

  img.rounded {
    border: 1px solid #eeeeee;
    border-radius: 10px ;
    -moz-border-radius: 10px ;
    -webkit-border-radius: 10px ;
  }

  a:link,a:visited
  {
    color: #0078c0;
    text-decoration: none;
  }
  a:hover {
    color: #0078c0;
  }

  td.dl-link {
    height: 160px;
    text-align: center;
    font-size: 22px;
  }

  .layered-paper-big { /* modified from: http://css-tricks.com/snippets/css/layered-paper/ */
    box-shadow:
            0px 0px 1px 1px rgba(0,0,0,0.35), /* The top layer shadow */
            5px 5px 0 0px #fff, /* The second layer */
            5px 5px 1px 1px rgba(0,0,0,0.35), /* The second layer shadow */
            10px 10px 0 0px #fff, /* The third layer */
            10px 10px 1px 1px rgba(0,0,0,0.35), /* The third layer shadow */
            15px 15px 0 0px #fff, /* The fourth layer */
            15px 15px 1px 1px rgba(0,0,0,0.35), /* The fourth layer shadow */
            20px 20px 0 0px #fff, /* The fifth layer */
            20px 20px 1px 1px rgba(0,0,0,0.35), /* The fifth layer shadow */
            25px 25px 0 0px #fff, /* The fifth layer */
            25px 25px 1px 1px rgba(0,0,0,0.35); /* The fifth layer shadow */
    margin-left: 10px;
    margin-right: 45px;
  }

  .paper-big { /* modified from: http://css-tricks.com/snippets/css/layered-paper/ */
    box-shadow:
            0px 0px 1px 1px rgba(0,0,0,0.35); /* The top layer shadow */

    margin-left: 10px;
    margin-right: 45px;
  }


  .layered-paper { /* modified from: http://css-tricks.com/snippets/css/layered-paper/ */
    box-shadow:
            0px 0px 1px 1px rgba(0,0,0,0.35), /* The top layer shadow */
            5px 5px 0 0px #fff, /* The second layer */
            5px 5px 1px 1px rgba(0,0,0,0.35), /* The second layer shadow */
            10px 10px 0 0px #fff, /* The third layer */
            10px 10px 1px 1px rgba(0,0,0,0.35); /* The third layer shadow */
    margin-top: 5px;
    margin-left: 10px;
    margin-right: 30px;
    margin-bottom: 5px;
  }

  .vert-cent {
    position: relative;
    top: 50%;
    transform: translateY(-50%);
  }

  hr
  {
    border-color: lightgray;
    border: 0;
    height: 1px;
    background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15), rgba(0, 0, 0, 0));
  }


  .project-header a{
    color: #0078c0;
  }
  .project-header a:hover{
    color: #C3D9F0;
  }
  .iccv-title {
    text-align: center;
    color: #0078c0;
  }

</style>

  <!-- Interactive Hat Selector Styles (scoped to its container) -->
  <style>
    #hat-selector-container {
      font-family: Arial, sans-serif;
      background-color: #ffffff;
      color: #333;
      margin: 20px auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #hat-selector-container table {
      border-collapse: collapse;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
    }
    #hat-selector-container th,
    #hat-selector-container td {
      border: 1px solid #eaeaea;
      text-align: center;
      vertical-align: middle;
      padding: 10px;
    }
    #hat-selector-container .clickable {
      width: 80px;
      height: 80px;
      object-fit: cover;
      cursor: pointer;
      transition: transform 0.3s ease;
      border-radius: 8px;
    }
    #hat-selector-container .clickable:hover {
      transform: scale(1.15);
    }
    #hat-selector-container .selected-source {
      outline: 3px solid #007BFF;
      border-radius: 8px;
    }
    #hat-selector-container .intersection-area {
      width: 350px;
      height: 350px;
      background-color: #f9f9f9;
      padding: 10px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.1);
      border-radius: 10px;
    }
    #hat-selector-container #intersectionImage {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      border-radius: 8px;
    }
  </style>

<html>
<head>
  <title>Griffin Project</title>
  <meta property="og:image" content="Path to my teaser.png"/> <!-- Facebook automatically scrapes this. Go to https://developers.facebook.com/tools/debug/ if you update and want to force Facebook to rescrape. -->
  <meta property="og:title" content="Creative and Descriptive Paper Title." />
  <meta property="og:description" content="Paper description." />

  <!-- Get from Google Analytics -->
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src=""></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-75863369-6');
  </script>
</head>

<body>

<br>

<center>
  <h1 class="title-font">
    <span class="iccv-title"><strong>Griffin</strong></span>: 
    Generative Reference and Layout <br> Guided Image Composition</span>
  </h1>
</center>

<!-- <br><br> -->
<center>
  <table align=center width=1000px>
    <tr>
      <td width=260px>
        <center>
          <img class="round" style="width:1000px" src="./resources/teaser.png"/>
          <p class="tldr-summary"><strong>TL;DR</strong>: We tackle multi-image layout control by letting a diffusion model learn where to place elements based on reference images rather than text. This enables precise composition, allowing objects to be positioned exactly as intended while maintaining their visual characteristics.</p>
        </center>
      </td>
    </tr>
  </table>
</center>

<!-- <hr> -->

<table align=center width=850px>
  <center><h2>Abstract</h2></center>
  <tr>
    <td style="text-align: justify;">
      Text-to-image models have reached a level of realism that enables highly convincing image generation. 
      The research community has dedicated significant effort to developing methods for controlling the content of generated images. 
      However, text-based control can be a limiting factor when more explicit guidance is needed. Defining both the content and its precise placement within an image is crucial for achieving finer control.
      In this work, we address the challenge of multi-image layout control, where the desired content is specified through images rather than text, 
      and the model is guided on where to place each element. Our approach is the first to successfully achieve this level of control, 
      and we demonstrate its effectiveness across various image composition tasks.
    </td>
  </tr>
</table>
<!-- <br> -->

<!-- <hr> -->
<center><h2>Results</h2></center>
<!-- <center><img src="./resources/r1.gif" alt="Results" width="800px"></center> -->
<div id="image-slider">
  <button id="previous-button" onclick="changeImageTransfer(-1)">
    <i class="fas fa-arrow-left"></i>
  </button>
  <img id="slider-image-transfer" src="./resources/results/1.png" alt="Results">
  <button id="next-button" onclick="changeImageTransfer(1)">
    <i class="fas fa-arrow-right"></i>
  </button>
  <div id="circle-container_transfer"></div>
</div>

<!-- <br> -->
<center><h2>Comparison</h2></center>
<center>
  <table align=center width=1000px>
    <tr>
      <td width=260px>
        <center>
          <img class="round" style="width:1000px" src="./resources/vis_comp.png"/>
        </center>
      </td>
    </tr>
  </table>
</center>
<!-- <hr> -->
<!-- <br> -->

<!-- <hr> -->
<center><h2>Method</h2></center>
<table align="center" width="1000px">
    <tr>
      <td>
        <ul style="margin-top: 0; font-size: 20px; text-align: justify;">
          <li>In this work, we propose a novel layout-controlled attention-sharing approach that seamlessly integrates with text-to-image diffusion models, leveraging source images and layout information (masks or bounding boxes) to achieve precise image composition.</li>
          <li>This addresses limitations in prior methods by respecting both the source images and the given layout.</li>
          <li>Griffin begins by employing an encoder-based personalization method (IP-Adapter) to establish the overall structure of the generated image.</li>
          <li>Once this structure is formed, we pass it to our proposed layout-controlled attention-sharing module, enabling fine-grained control over both appearance and placement.</li>
          <li>A key advantage of our method lies in its ability to use only a single reference image per subject, while supporting both object-level and part-level compositions.</li>
        </ul>
      </td>
    </tr>
  </table>


<!-- <table align=center width=800px>
    <br>
    <tr><center>
        <span style="font-size:28px">&nbsp;<a href='https://github.com/richzhang/webpage-template'>[GitHub]</a>
        </center>
    </span>
</table> -->
<!-- <br> -->
<center><h2>Additional Results</h2></center>
<!-- Replacing the original Additional Results section with the Interactive Hat Selector -->
<div id="hat-selector-container">
  <table>
    <tr>
      <th></th>
      <th><img id="hatImg-beret" src="./resources/hats/beret.png" alt="Beret" class="clickable" onclick="selectHat('beret')"></th>
      <th><img id="hatImg-blue" src="./resources/hats/blue.png" alt="Blue Hat" class="clickable" onclick="selectHat('blue')"></th>
      <th><img id="hatImg-cap" src="./resources/hats/cap.png" alt="Cap" class="clickable" onclick="selectHat('cap')"></th>
      <th><img id="hatImg-panama" src="./resources/hats/panama.png" alt="Panama Hat" class="clickable" onclick="selectHat('panama')"></th>
      <th><img id="hatImg-top" src="./resources/hats/top.png" alt="Top Hat" class="clickable" onclick="selectHat('top')"></th>
    </tr>

    <tr>
      <th><img id="categoryImg-cat" src="./resources/hats/cat.png" alt="Cat" class="clickable" onclick="selectCategory('cat')"></th>
      <td class="intersection-area" colspan="5" rowspan="4">
        <img id="intersectionImage" alt="Selected Image">
      </td>
    </tr>

    <tr>
      <th><img id="categoryImg-dog" src="./resources/hats/dog.png" alt="Dog" class="clickable" onclick="selectCategory('dog')"></th>
    </tr>

    <tr>
      <th><img id="categoryImg-man" src="./resources/hats/man.png" alt="Man" class="clickable" onclick="selectCategory('man')"></th>
    </tr>

    <tr>
      <th><img id="categoryImg-woman" src="./resources/hats/woman.png" alt="Woman" class="clickable" onclick="selectCategory('woman')"></th>
    </tr>
  </table>

  <script>
    let selectedCategory = 'cat';
    let selectedHat = 'beret';

    function selectCategory(category) {
      selectedCategory = category;
      ['cat', 'dog', 'man', 'woman'].forEach(cat => {
        document.getElementById(`categoryImg-${cat}`).classList.remove('selected-source');
      });
      document.getElementById(`categoryImg-${category}`).classList.add('selected-source');
      updateIntersection();
    }

    function selectHat(hat) {
      selectedHat = hat;
      ['beret', 'blue', 'cap', 'panama', 'top'].forEach(h => {
        document.getElementById(`hatImg-${h}`).classList.remove('selected-source');
      });
      document.getElementById(`hatImg-${hat}`).classList.add('selected-source');
      updateIntersection();
    }

    function updateIntersection() {
      const intersectionImg = document.getElementById('intersectionImage');
      intersectionImg.src = `./resources/hats/${selectedCategory}_${selectedHat}.png`;
      intersectionImg.alt = `${selectedCategory} wearing a ${selectedHat}`;
    }

    window.onload = function() {
      selectCategory(selectedCategory);
      selectHat(selectedHat);
    };
  </script>
</div>

<br>

<script>
  var currentImageIndexTransfer = 1;
  var numOfImagesTransfer = 13;
  var currentImageIndexGeneration = 1;
  var numOfImagesGeneration = 8;
  var autoSlideInterval; // For auto sliding the transfer images

  window.onload = function() {
    // Initialize hat selector functions first (if needed)
    if (typeof selectCategory === "function" && typeof selectHat === "function") {
      selectCategory(selectedCategory);
      selectHat(selectedHat);
    }
    
    var container_transfer = document.getElementById('circle-container_transfer');
    for (var i = 1; i <= numOfImagesTransfer; i++) {
      var circle = document.createElement('div');
      circle.className = 'circle';
      circle.id = 'circle-transfer-' + i;
      container_transfer.appendChild(circle);
    }
    updateCirclesTransfer();

    // Setup auto slide: advance the transfer slider every 2000ms
    autoSlideInterval = setInterval(function(){
      changeImageTransfer(1);
    }, 2000);

    // Pause auto slide on mouse enter, resume on mouse leave
    var slider = document.getElementById('image-slider');
    slider.addEventListener('mouseenter', function(){
      clearInterval(autoSlideInterval);
    });
    slider.addEventListener('mouseleave', function(){
      autoSlideInterval = setInterval(function(){
        changeImageTransfer(1);
      }, 2000);
    });
  };

  function updateCirclesTransfer() {
    for (var i = 1; i <= numOfImagesTransfer; i++) {
      var circle = document.getElementById('circle-transfer-' + i);
      circle.className = 'circle';
      if (i === currentImageIndexTransfer) {
        circle.classList.add('selected');
      }
    }
  }

  function changeImageTransfer(direction) {
    currentImageIndexTransfer += direction;
    if (currentImageIndexTransfer < 1) {
      currentImageIndexTransfer = numOfImagesTransfer;
    } else if (currentImageIndexTransfer > numOfImagesTransfer) {
      currentImageIndexTransfer = 1;
    }
    var newSrc = "./resources/results/" + currentImageIndexTransfer + ".png";
    newSrc += '?' + new Date().getTime(); // Cache buster
    document.getElementById('slider-image-transfer').src = newSrc;
    updateCirclesTransfer();
  }

  function changeImageGeneration(direction) {
    currentImageIndexGeneration += direction;
    if (currentImageIndexGeneration < 1) {
      currentImageIndexGeneration = numOfImagesGeneration;
    } else if (currentImageIndexGeneration > numOfImagesGeneration) {
      currentImageIndexGeneration = 1;
    }
    var newSrc = "./resources/generation_results/" + currentImageIndexGeneration + ".png";
    newSrc += '?' + new Date().getTime();
    document.getElementById('slider-image-generation').src = newSrc;
    updateCirclesGeneration();
  }

  function updateCirclesGeneration() {
    // Implementation for generation circles (if needed)
  }

  function copyToClipboard() {
    var bibtexText = document.getElementById("bibtex").innerText;
    navigator.clipboard.writeText(bibtexText)
      .then(() => {
        alert("BibTeX citation copied to clipboard!");
      })
      .catch(err => {
        console.error('Error copying text: ', err);
      });
  }
</script>

</body>
</html>